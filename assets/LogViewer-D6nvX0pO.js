import{j as t,C as d,F as m}from"./bootstrap-vendor-BaqZ8axc.js";import{r as o}from"./react-vendor-BxsFYPlk.js";import{u as S}from"./useWebSocket-Ct4q0eJe.js";import{l as y}from"./index-CGOhfWMY.js";import"./axios-vendor-B9ygI19o.js";function k({instances:p,selectedInstanceId:s,onInstanceChange:x}){const[i,c]=o.useState([]),[r,g]=o.useState(""),[u,h]=o.useState(!0),l=o.useRef(null),f=s?`ws://localhost:8000/ws/logs/${s}`:null,{lastMessage:a}=S(f);o.useEffect(()=>{s?v():c([])},[s,r]),o.useEffect(()=>{if(a&&a.type==="log"){const e={level:"info",message:a.data.message,timestamp:new Date().toISOString()};c(n=>[...n,e].slice(-500))}},[a]),o.useEffect(()=>{u&&l.current&&(l.current.scrollTop=l.current.scrollHeight)},[i,u]);const v=async()=>{if(s)try{const e=await y.getLogs(s,100,r||void 0);c(e.data.logs)}catch(e){console.error("Failed to load logs:",e)}},j=e=>({info:"text-info",warning:"text-warning",error:"text-danger"})[e]||"text-secondary",w=r?i.filter(e=>e.level===r):i;return t.jsxs(d,{children:[t.jsx(d.Header,{children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("h5",{className:"mb-0",children:"日志查看"}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs(m.Select,{value:s||"",onChange:e=>x(e.target.value?parseInt(e.target.value):null),style:{width:"auto"},children:[t.jsx("option",{value:"",children:"选择实例"}),p.filter(e=>e.status==="running").map(e=>t.jsxs("option",{value:e.id,children:[e.name," (端口: ",e.port,")"]},e.id))]}),t.jsxs(m.Select,{value:r,onChange:e=>g(e.target.value),style:{width:"auto"},children:[t.jsx("option",{value:"",children:"全部级别"}),t.jsx("option",{value:"info",children:"Info"}),t.jsx("option",{value:"warning",children:"Warning"}),t.jsx("option",{value:"error",children:"Error"})]}),t.jsx(m.Check,{type:"switch",label:"自动滚动",checked:u,onChange:e=>h(e.target.checked)})]})]})}),t.jsx(d.Body,{children:s?t.jsx("div",{ref:l,style:{height:"400px",overflowY:"auto",fontFamily:"monospace",fontSize:"12px",backgroundColor:"#1e1e1e",color:"#d4d4d4",padding:"10px"},children:w.map((e,n)=>t.jsxs("div",{className:j(e.level),children:[e.timestamp&&t.jsxs("span",{className:"text-muted",children:["[",new Date(e.timestamp).toLocaleString(),"] "]}),t.jsxs("span",{className:"text-muted",children:["[",e.level.toUpperCase(),"] "]}),e.message]},n))}):t.jsx("div",{className:"text-center text-muted p-5",children:"请选择一个运行中的实例"})})]})}export{k as default};
