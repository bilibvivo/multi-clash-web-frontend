const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./InstanceList-BgUnfGH0.js","./bootstrap-vendor-BaqZ8axc.js","./react-vendor-BxsFYPlk.js","./ConfigViewer-Def5HEbj.js","./axios-vendor-B9ygI19o.js","./SubscriptionManager-DsR1wQPl.js","./TrafficMonitor-rgZn1VAd.js","./useWebSocket-Ct4q0eJe.js","./chart-vendor-BOne-368.js","./LogViewer-C7h9M7ZX.js","./YacdEmbed-Cf5tefB1.js","./MetaCubeXdEmbed-BOdnX5jO.js","./ZashboardEmbed-BwzCP7kj.js"])))=>i.map(i=>d[i]);
import{j as e,T as D,a as _,B as C,M as v,F as b}from"./bootstrap-vendor-BaqZ8axc.js";import{b as O,r as t,H as B,d as K,e as H,R as U}from"./react-vendor-BxsFYPlk.js";import{a as W}from"./axios-vendor-B9ygI19o.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const h of c)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function o(c){const h={};return c.integrity&&(h.integrity=c.integrity),c.referrerPolicy&&(h.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?h.credentials="include":c.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function l(c){if(c.ep)return;c.ep=!0;const h=o(c);fetch(c.href,h)}})();var T={},R=O;T.createRoot=R.createRoot,T.hydrateRoot=R.hydrateRoot;const q="modulepreload",G=function(s,n){return new URL(s,n).href},A={},N=function(n,o,l){let c=Promise.resolve();if(o&&o.length>0){const p=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),j=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));c=Promise.allSettled(o.map(a=>{if(a=G(a,l),a in A)return;A[a]=!0;const f=a.endsWith(".css"),d=f?'[rel="stylesheet"]':"";if(!!l)for(let x=p.length-1;x>=0;x--){const g=p[x];if(g.href===a&&(!f||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${d}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":q,f||(m.as="script"),m.crossOrigin="",m.href=a,j&&m.setAttribute("nonce",j),document.head.appendChild(m),f)return new Promise((x,g)=>{m.addEventListener("load",x),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}function h(p){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=p,window.dispatchEvent(r),!r.defaultPrevented)throw p}return c.then(p=>{for(const r of p||[])r.status==="rejected"&&h(r.reason);return n().catch(h)})},Y="http://localhost:8000/api",i=W.create({baseURL:Y,headers:{"Content-Type":"application/json"}}),$={getAll:()=>i.get("/instances"),getById:s=>i.get(`/instances/${s}`),create:s=>i.post("/instances",s),update:(s,n)=>i.put(`/instances/${s}`,n),delete:s=>i.delete(`/instances/${s}`),start:s=>i.post(`/instances/${s}/start`),stop:s=>i.post(`/instances/${s}/stop`),restart:s=>i.post(`/instances/${s}/restart`),updateConfig:s=>i.post(`/instances/${s}/update-config`),getConfig:s=>i.get(`/instances/${s}/config`),getWsInfo:s=>i.get(`/instances/${s}/ws-info`),setSystemProxy:s=>i.post(`/instances/${s}/set-system-proxy`),unsetSystemProxy:s=>i.post(`/instances/${s}/unset-system-proxy`),setAutoStart:(s,n)=>i.post(`/instances/${s}/set-auto-start?auto_start=${n}`)},X={getAll:()=>i.get("/subscriptions"),create:s=>i.post("/subscriptions",s),update:(s,n)=>i.put(`/subscriptions/${s}`,n),delete:s=>i.delete(`/subscriptions/${s}`),updateContent:s=>i.post(`/subscriptions/${s}/update`),getConfig:s=>i.get(`/subscriptions/${s}/config`),getExtendConfig:s=>i.get(`/subscriptions/${s}/extend-config`),saveExtendConfig:(s,n)=>i.post(`/subscriptions/${s}/extend-config`,{content:n})},xe={getLogs:(s,n,o)=>i.get(`/logs/${s}`,{params:{lines:n,level:o}})},P={getExtendConfig:()=>i.get("/config/extend"),saveExtendConfig:s=>i.post("/config/extend",{content:s})},M={getVersion:()=>i.get("/clash/version"),getLatestVersion:()=>i.get("/clash/latest-version")},F={getStatus:()=>i.get("/service/status"),install:()=>i.post("/service/install"),uninstall:()=>i.post("/service/uninstall"),start:()=>i.post("/service/start"),stop:()=>i.post("/service/stop")},V=t.createContext(void 0);function I(){const s=t.useContext(V);if(!s)throw new Error("useToast must be used within ToastProvider");return s}function Z({children:s}){const[n,o]=t.useState([]),l=t.useCallback((h,p="info")=>{const r=Date.now();o(j=>[...j,{id:r,message:h,type:p}]),setTimeout(()=>{o(j=>j.filter(a=>a.id!==r))},3e3)},[]),c=t.useCallback(h=>{o(p=>p.filter(r=>r.id!==h))},[]);return e.jsxs(V.Provider,{value:{showToast:l},children:[s,e.jsx(J,{toasts:n,onRemove:c})]})}function J({toasts:s,onRemove:n}){return s.length===0?null:e.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",maxWidth:"500px",width:"90%"},children:s.map(o=>e.jsx(Q,{toast:o,onRemove:n},o.id))})}function Q({toast:s,onRemove:n}){const o=()=>{switch(s.type){case"success":return"success";case"error":return"danger";case"warning":return"warning";default:return"info"}},l=()=>{switch(s.type){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}};return e.jsxs("div",{className:`alert alert-${o()} alert-dismissible fade show`,role:"alert",style:{margin:0,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",animation:"slideDown 0.3s ease-out"},children:[e.jsx("strong",{children:l()})," ",s.message,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>n(s.id),"aria-label":"Close"}),e.jsx("style",{children:`
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})}const ee=t.lazy(()=>N(()=>import("./InstanceList-BgUnfGH0.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),se=t.lazy(()=>N(()=>import("./SubscriptionManager-DsR1wQPl.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),te=t.lazy(()=>N(()=>import("./TrafficMonitor-rgZn1VAd.js"),__vite__mapDeps([6,1,2,7,8,4]),import.meta.url)),ne=t.lazy(()=>N(()=>import("./LogViewer-C7h9M7ZX.js"),__vite__mapDeps([9,1,2,7,4]),import.meta.url)),re=t.lazy(()=>N(()=>import("./YacdEmbed-Cf5tefB1.js"),__vite__mapDeps([10,1,2]),import.meta.url)),ae=t.lazy(()=>N(()=>import("./MetaCubeXdEmbed-BOdnX5jO.js"),__vite__mapDeps([11,1,2]),import.meta.url)),ie=t.lazy(()=>N(()=>import("./ZashboardEmbed-BwzCP7kj.js"),__vite__mapDeps([12,1,2]),import.meta.url)),E=()=>e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"加载中..."})})});function oe(){const{showToast:s}=I(),[n,o]=t.useState(null),[l,c]=t.useState([]),[h,p]=t.useState(!1),[r,j]=t.useState(!1),[a,f]=t.useState({name:"",subscription_id:null,port:null,mixed_port:null}),[d,S]=t.useState([]),[m,x]=t.useState("instances"),g=async()=>{try{const u=await $.getAll();c(u.data)}catch(u){console.error("Failed to load instances:",u)}};t.useEffect(()=>{g()},[]);const y=async()=>{try{const u=await X.getAll();S(u.data)}catch(u){console.error("Failed to load subscriptions:",u)}},w=async u=>{var L,k;u.preventDefault(),j(!0);try{await $.create(a),p(!1),f({name:"",subscription_id:null,port:null,mixed_port:null}),s("实例创建成功","success"),g()}catch(z){s(((k=(L=z.response)==null?void 0:L.data)==null?void 0:k.detail)||"创建失败","error")}finally{j(!1)}};return e.jsxs("div",{children:[e.jsx("div",{className:"panel-body",children:e.jsxs(D,{activeKey:m,onSelect:u=>u&&x(u),id:"main-tabs",className:"mb-3 modern-tabs",children:[e.jsx(_,{eventKey:"instances",title:"实例列表",children:m==="instances"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"实例列表"}),e.jsx(C,{onClick:()=>{y(),p(!0)},children:"创建新实例"})]}),e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(ee,{onRefresh:()=>{g()}})})]})}),e.jsx(_,{eventKey:"subscriptions",title:"订阅管理",children:m==="subscriptions"&&e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(se,{})})}),e.jsx(_,{eventKey:"traffic",title:"流量监控",children:m==="traffic"&&e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(te,{instances:l,selectedInstanceId:n,onInstanceChange:o})})}),e.jsx(_,{eventKey:"logs",title:"日志查看",children:m==="logs"&&e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(ne,{instances:l,selectedInstanceId:n,onInstanceChange:o})})}),e.jsx(_,{eventKey:"yacd",title:"Yacd 控制台",children:m==="yacd"&&e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(re,{instances:l,selectedInstanceId:n,onInstanceChange:o})})}),e.jsx(_,{eventKey:"metacubexd",title:"metacubexd 控制台",children:m==="metacubexd"&&e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(ae,{instances:l,selectedInstanceId:n,onInstanceChange:o})})}),e.jsx(_,{eventKey:"zashboard",title:"Zashboard 控制台",children:m==="zashboard"&&e.jsx(t.Suspense,{fallback:e.jsx(E,{}),children:e.jsx(ie,{instances:l,selectedInstanceId:n,onInstanceChange:o})})})]})}),e.jsxs(v,{show:h,onHide:()=>!r&&p(!1),children:[e.jsx(v.Header,{closeButton:!r,children:e.jsx(v.Title,{children:"创建新实例"})}),e.jsxs(b,{onSubmit:w,children:[e.jsxs(v.Body,{children:[e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"实例名称"}),e.jsx(b.Control,{type:"text",value:a.name,onChange:u=>f({...a,name:u.target.value}),required:!0,disabled:r})]}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"订阅"}),e.jsxs(b.Select,{value:a.subscription_id||"",onChange:u=>f({...a,subscription_id:u.target.value?parseInt(u.target.value):null}),required:!0,disabled:r,children:[e.jsx("option",{value:"",children:"选择订阅"}),d.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"管理端口（可选，自动分配）"}),e.jsx(b.Control,{type:"number",value:a.port||"",onChange:u=>f({...a,port:u.target.value?parseInt(u.target.value):null}),disabled:r})]}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"混合端口（可选，自动分配）"}),e.jsx(b.Control,{type:"number",value:a.mixed_port||"",onChange:u=>f({...a,mixed_port:u.target.value?parseInt(u.target.value):null}),disabled:r})]})]}),e.jsxs(v.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>p(!1),disabled:r,children:"取消"}),e.jsx(C,{variant:"primary",type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"创建中..."]}):"创建"})]})]})]})]})}function le({show:s,onHide:n,title:o}){const{showToast:l}=I(),[c,h]=t.useState(""),[p,r]=t.useState(!1),[j,a]=t.useState(!1),[f,d]=t.useState(null);t.useEffect(()=>{s&&S()},[s]);const S=async()=>{var x,g;r(!0),d(null);try{const y=await P.getExtendConfig();h(y.data.content||"")}catch(y){d(((g=(x=y.response)==null?void 0:x.data)==null?void 0:g.detail)||"加载配置文件失败"),h("")}finally{r(!1)}},m=async()=>{var x,g;a(!0),d(null);try{await P.saveExtendConfig(c),n(),l("配置文件保存成功","success")}catch(y){const w=((g=(x=y.response)==null?void 0:x.data)==null?void 0:g.detail)||"保存配置文件失败";d(w),l(w,"error")}finally{a(!1)}};return e.jsxs(v,{show:s,onHide:n,size:"lg",fullscreen:"lg-down",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:o})}),e.jsxs(v.Body,{style:{padding:0},children:[f&&e.jsx("div",{className:"alert alert-danger m-3 mb-0",role:"alert",children:f}),p?e.jsx("div",{className:"p-5 text-center",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"加载中..."})})}):e.jsx("textarea",{value:c,onChange:x=>h(x.target.value),style:{width:"100%",height:"70vh",padding:"15px",fontFamily:'Consolas, Monaco, "Courier New", monospace',fontSize:"13px",lineHeight:"1.5",border:"none",outline:"none",backgroundColor:"#1e1e1e",color:"#d4d4d4",resize:"none",whiteSpace:"pre",overflowWrap:"normal",overflowX:"auto"},spellCheck:!1})]}),e.jsxs(v.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:n,disabled:j,children:"取消"}),e.jsx(C,{variant:"primary",onClick:m,disabled:p||j,children:j?"保存中...":"保存"})]})]})}function ce(){const{showToast:s}=I(),[n,o]=t.useState(!1),[l,c]=t.useState(null),[h,p]=t.useState(!1),r=async()=>{var a,f;try{const d=await F.getStatus();c(d.data)}catch(d){((a=d.response)==null?void 0:a.status)===404||((f=d.response)==null?void 0:f.status)===400?c({installed:!1,running:!1,service_name:"ClashMultiInstanceManager"}):console.error("获取服务状态失败:",d)}};t.useEffect(()=>{n&&r()},[n]);const j=async()=>{var a,f;p(!0);try{await F.install(),s("服务注册成功","success"),await r()}catch(d){s(((f=(a=d.response)==null?void 0:a.data)==null?void 0:f.detail)||"服务注册失败","error")}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outline-light",size:"sm",onClick:()=>o(!0),className:"ghost-button me-2",children:"Windows 服务控制"}),e.jsxs(v,{show:n,onHide:()=>o(!1),children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Windows 服务控制"})}),e.jsx(v.Body,{children:l?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"服务名称:"})," ",l.service_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"安装状态:"})," ",l.installed?"已安装":"未安装"]}),l.installed&&e.jsxs("p",{children:[e.jsx("strong",{children:"运行状态:"})," ",l.running?"运行中":"已停止"]}),e.jsx("div",{className:"mt-3",children:l.installed?null:e.jsx(C,{variant:"primary",onClick:j,disabled:h,className:"me-2",children:h?"注册中...":"注册服务"})}),e.jsx("div",{className:"mt-3 text-muted small",children:e.jsx("p",{children:"提示：注册/卸载服务需要管理员权限"})})]}):e.jsx("p",{children:"读取中..."})}),e.jsx(v.Footer,{children:e.jsx(C,{variant:"secondary",onClick:()=>o(!1),children:"关闭"})})]})]})}function de(){const{showToast:s}=I(),[n,o]=t.useState(!1),[l,c]=t.useState(""),[h,p]=t.useState(""),[r,j]=t.useState(!1);t.useEffect(()=>{M.getVersion().then(d=>{d.data.version&&d.data.version!=="unknown"&&d.data.version!=="not_found"&&d.data.version!=="error"&&(c(d.data.version),p(d.data.full_output||""))}).catch(d=>{console.error("获取 Clash 版本失败:",d)})},[]);const a=(d,S)=>{const m=d.replace(/^v/i,"").split(".").map(Number),x=S.replace(/^v/i,"").split(".").map(Number),g=Math.max(m.length,x.length);for(let y=0;y<g;y++){const w=m[y]||0,u=x[y]||0;if(w>u)return 1;if(w<u)return-1}return 0},f=async()=>{var d,S;if(!l){s("请先获取当前版本信息","warning");return}j(!0);try{const x=(await M.getLatestVersion()).data.latest_version.trim();if(!x)throw new Error("无法获取版本号");const g=a(x,l);g>0?s(`发现新版本: ${x}`,"info"):g<0?s(`当前版本 ${l} 新于最新发布版`,"success"):s("已经是最新版本","success")}catch(m){console.error("检查更新失败:",m);const x=((S=(d=m.response)==null?void 0:d.data)==null?void 0:S.detail)||m.message||"检查失败";s("检查更新失败: "+x,"error")}finally{j(!1)}};return e.jsx(B,{children:e.jsx("div",{className:"app-shell",children:e.jsxs("div",{className:"app-container container-xxl py-4",children:[e.jsxs("div",{className:"app-hero mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"brand-mark",children:"CM"}),e.jsxs("div",{children:[e.jsx("p",{className:"eyebrow",children:"Clash Multi-Instance"}),e.jsx("h1",{className:"hero-title",children:"Clash多实例管理后台"}),e.jsx("p",{className:"hero-subtitle",children:"现代化的轻量控制台，集中管理订阅、实例、流量与系统代理。"})]})]}),e.jsxs("div",{className:"d-flex flex-column align-items-start align-items-lg-end gap-2 ms-lg-auto",children:[l?e.jsxs("div",{className:"version-chip",title:h,children:[e.jsxs("div",{className:"version-chip__label",children:["Clash v",l]}),e.jsx(C,{variant:"outline-light",size:"sm",onClick:f,disabled:r,className:"ghost-button ghost-button--compact",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"检查中..."]}):"检查更新"})]}):e.jsx("div",{className:"version-chip",children:e.jsx("div",{className:"version-chip__label",children:"版本信息读取中..."})}),e.jsxs("div",{className:"hero-actions",children:[e.jsx(ce,{}),e.jsx(C,{variant:"light",size:"sm",onClick:()=>o(!0),className:"accent-button",children:"全局扩展配置"})]})]})]}),e.jsx("div",{className:"panel-card mt-4",children:e.jsx(K,{children:e.jsx(H,{path:"/",element:e.jsx(oe,{})})})}),e.jsx(le,{show:n,onHide:()=>o(!1),title:"全局扩展配置"})]})})})}function ue(){return e.jsx(Z,{children:e.jsx(de,{})})}T.createRoot(document.getElementById("root")).render(e.jsx(U.StrictMode,{children:e.jsx(ue,{})}));export{$ as i,xe as l,X as s,I as u};
