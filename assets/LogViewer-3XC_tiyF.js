import{j as t,C as d,F as g}from"./bootstrap-vendor-BaqZ8axc.js";import{r as o}from"./react-vendor-BxsFYPlk.js";import{u as y}from"./useWebSocket-Ct4q0eJe.js";import{g as C,l as L}from"./index-B0uoZxv7.js";import"./axios-vendor-B9ygI19o.js";function U({instances:m,selectedInstanceId:s,onInstanceChange:p}){const[i,c]=o.useState([]),[r,x]=o.useState(""),[u,f]=o.useState(!0),l=o.useRef(null),h=C(),v=s?`${h}/ws/logs/${s}`:null,{lastMessage:a}=y(v);o.useEffect(()=>{s?j():c([])},[s,r]),o.useEffect(()=>{if(a&&a.type==="log"){const e={level:"info",message:a.data.message,timestamp:new Date().toISOString()};c(n=>[...n,e].slice(-500))}},[a]),o.useEffect(()=>{u&&l.current&&(l.current.scrollTop=l.current.scrollHeight)},[i,u]);const j=async()=>{if(s)try{const e=await L.getLogs(s,100,r||void 0);c(e.data.logs)}catch(e){console.error("Failed to load logs:",e)}},w=e=>({info:"text-info",warning:"text-warning",error:"text-danger"})[e]||"text-secondary",S=r?i.filter(e=>e.level===r):i;return t.jsxs(d,{children:[t.jsx(d.Header,{children:t.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[t.jsx("h5",{className:"mb-0",children:"日志查看"}),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsxs(g.Select,{value:s||"",onChange:e=>p(e.target.value?parseInt(e.target.value):null),style:{width:"auto"},children:[t.jsx("option",{value:"",children:"选择实例"}),m.filter(e=>e.status==="running").map(e=>t.jsxs("option",{value:e.id,children:[e.name," (端口: ",e.port,")"]},e.id))]}),t.jsxs(g.Select,{value:r,onChange:e=>x(e.target.value),style:{width:"auto"},children:[t.jsx("option",{value:"",children:"全部级别"}),t.jsx("option",{value:"info",children:"Info"}),t.jsx("option",{value:"warning",children:"Warning"}),t.jsx("option",{value:"error",children:"Error"})]}),t.jsx(g.Check,{type:"switch",label:"自动滚动",checked:u,onChange:e=>f(e.target.checked)})]})]})}),t.jsx(d.Body,{children:s?t.jsx("div",{ref:l,style:{height:"400px",overflowY:"auto",fontFamily:"monospace",fontSize:"12px",backgroundColor:"#1e1e1e",color:"#d4d4d4",padding:"10px"},children:S.map((e,n)=>t.jsxs("div",{className:w(e.level),children:[e.timestamp&&t.jsxs("span",{className:"text-muted",children:["[",new Date(e.timestamp).toLocaleString(),"] "]}),t.jsxs("span",{className:"text-muted",children:["[",e.level.toUpperCase(),"] "]}),e.message]},n))}):t.jsx("div",{className:"text-center text-muted p-5",children:"请选择一个运行中的实例"})})]})}export{U as default};
