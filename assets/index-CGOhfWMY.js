const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./InstanceList-C6-9KwvX.js","./bootstrap-vendor-BaqZ8axc.js","./react-vendor-BxsFYPlk.js","./ConfigViewer-DhBUcY6c.js","./axios-vendor-B9ygI19o.js","./SubscriptionManager-DQl4pB_6.js","./TrafficMonitor-BE__sN9o.js","./useWebSocket-Ct4q0eJe.js","./chart-vendor-BOne-368.js","./LogViewer-D6nvX0pO.js","./YacdEmbed-Cf5tefB1.js","./MetaCubeXdEmbed-BOdnX5jO.js","./ZashboardEmbed-BwzCP7kj.js"])))=>i.map(i=>d[i]);
import{j as e,T as D,a as w,B as y,M as v,F as b}from"./bootstrap-vendor-BaqZ8axc.js";import{b as F,r as t,H as O,d as z,e as B,R as K}from"./react-vendor-BxsFYPlk.js";import{a as H}from"./axios-vendor-B9ygI19o.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const h of d)if(h.type==="childList")for(const p of h.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function l(d){const h={};return d.integrity&&(h.integrity=d.integrity),d.referrerPolicy&&(h.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?h.credentials="include":d.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function c(d){if(d.ep)return;d.ep=!0;const h=l(d);fetch(d.href,h)}})();var L={},T=F;L.createRoot=T.createRoot,L.hydrateRoot=T.hydrateRoot;const U="modulepreload",W=function(s,n){return new URL(s,n).href},k={},E=function(n,l,c){let d=Promise.resolve();if(l&&l.length>0){const p=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),g=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));d=Promise.allSettled(l.map(i=>{if(i=W(i,c),i in k)return;k[i]=!0;const x=i.endsWith(".css"),u=x?'[rel="stylesheet"]':"";if(!!c)for(let m=p.length-1;m>=0;m--){const j=p[m];if(j.href===i&&(!x||j.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${u}`))return;const f=document.createElement("link");if(f.rel=x?"stylesheet":U,x||(f.as="script"),f.crossOrigin="",f.href=i,g&&f.setAttribute("nonce",g),document.head.appendChild(f),x)return new Promise((m,j)=>{f.addEventListener("load",m),f.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${i}`)))})}))}function h(p){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=p,window.dispatchEvent(r),!r.defaultPrevented)throw p}return d.then(p=>{for(const r of p||[])r.status==="rejected"&&h(r.reason);return n().catch(h)})},q="http://localhost:8000/api",o=H.create({baseURL:q,headers:{"Content-Type":"application/json"}}),R={getAll:()=>o.get("/instances"),getById:s=>o.get(`/instances/${s}`),create:s=>o.post("/instances",s),update:(s,n)=>o.put(`/instances/${s}`,n),delete:s=>o.delete(`/instances/${s}`),start:s=>o.post(`/instances/${s}/start`),stop:s=>o.post(`/instances/${s}/stop`),restart:s=>o.post(`/instances/${s}/restart`),updateConfig:s=>o.post(`/instances/${s}/update-config`),getConfig:s=>o.get(`/instances/${s}/config`),getWsInfo:s=>o.get(`/instances/${s}/ws-info`),setSystemProxy:s=>o.post(`/instances/${s}/set-system-proxy`),unsetSystemProxy:s=>o.post(`/instances/${s}/unset-system-proxy`),setAutoStart:(s,n)=>o.post(`/instances/${s}/set-auto-start?auto_start=${n}`)},G={getAll:()=>o.get("/subscriptions"),create:s=>o.post("/subscriptions",s),update:(s,n)=>o.put(`/subscriptions/${s}`,n),delete:s=>o.delete(`/subscriptions/${s}`),updateContent:s=>o.post(`/subscriptions/${s}/update`),getConfig:s=>o.get(`/subscriptions/${s}/config`),getExtendConfig:s=>o.get(`/subscriptions/${s}/extend-config`),saveExtendConfig:(s,n)=>o.post(`/subscriptions/${s}/extend-config`,{content:n})},pe={getLogs:(s,n,l)=>o.get(`/logs/${s}`,{params:{lines:n,level:l}})},A={getExtendConfig:()=>o.get("/config/extend"),saveExtendConfig:s=>o.post("/config/extend",{content:s})},$={getVersion:()=>o.get("/clash/version"),getLatestVersion:()=>o.get("/clash/latest-version")},P={getStatus:()=>o.get("/service/status"),install:()=>o.post("/service/install"),uninstall:()=>o.post("/service/uninstall"),start:()=>o.post("/service/start"),stop:()=>o.post("/service/stop")},M=t.createContext(void 0);function I(){const s=t.useContext(M);if(!s)throw new Error("useToast must be used within ToastProvider");return s}function Y({children:s}){const[n,l]=t.useState([]),c=t.useCallback((h,p="info")=>{const r=Date.now();l(g=>[...g,{id:r,message:h,type:p}]),setTimeout(()=>{l(g=>g.filter(i=>i.id!==r))},3e3)},[]),d=t.useCallback(h=>{l(p=>p.filter(r=>r.id!==h))},[]);return e.jsxs(M.Provider,{value:{showToast:c},children:[s,e.jsx(X,{toasts:n,onRemove:d})]})}function X({toasts:s,onRemove:n}){return s.length===0?null:e.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",maxWidth:"500px",width:"90%"},children:s.map(l=>e.jsx(Z,{toast:l,onRemove:n},l.id))})}function Z({toast:s,onRemove:n}){const l=()=>{switch(s.type){case"success":return"success";case"error":return"danger";case"warning":return"warning";default:return"info"}},c=()=>{switch(s.type){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}};return e.jsxs("div",{className:`alert alert-${l()} alert-dismissible fade show`,role:"alert",style:{margin:0,boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",animation:"slideDown 0.3s ease-out"},children:[e.jsx("strong",{children:c()})," ",s.message,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>n(s.id),"aria-label":"Close"}),e.jsx("style",{children:`
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})}const J=t.lazy(()=>E(()=>import("./InstanceList-C6-9KwvX.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),Q=t.lazy(()=>E(()=>import("./SubscriptionManager-DQl4pB_6.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url)),ee=t.lazy(()=>E(()=>import("./TrafficMonitor-BE__sN9o.js"),__vite__mapDeps([6,1,2,7,8,4]),import.meta.url)),se=t.lazy(()=>E(()=>import("./LogViewer-D6nvX0pO.js"),__vite__mapDeps([9,1,2,7,4]),import.meta.url)),te=t.lazy(()=>E(()=>import("./YacdEmbed-Cf5tefB1.js"),__vite__mapDeps([10,1,2]),import.meta.url)),ne=t.lazy(()=>E(()=>import("./MetaCubeXdEmbed-BOdnX5jO.js"),__vite__mapDeps([11,1,2]),import.meta.url)),re=t.lazy(()=>E(()=>import("./ZashboardEmbed-BwzCP7kj.js"),__vite__mapDeps([12,1,2]),import.meta.url)),_=()=>e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"加载中..."})})});function ae(){const{showToast:s}=I(),[n,l]=t.useState(null),[c,d]=t.useState([]),[h,p]=t.useState(!1),[r,g]=t.useState(!1),[i,x]=t.useState({name:"",subscription_id:null,port:null,mixed_port:null}),[u,C]=t.useState([]),f=async()=>{try{const a=await R.getAll();d(a.data)}catch(a){console.error("Failed to load instances:",a)}};t.useEffect(()=>{f()},[]);const m=async()=>{try{const a=await G.getAll();C(a.data)}catch(a){console.error("Failed to load subscriptions:",a)}},j=async a=>{var S,N;a.preventDefault(),g(!0);try{await R.create(i),p(!1),x({name:"",subscription_id:null,port:null,mixed_port:null}),s("实例创建成功","success"),f()}catch(V){s(((N=(S=V.response)==null?void 0:S.data)==null?void 0:N.detail)||"创建失败","error")}finally{g(!1)}};return e.jsxs("div",{children:[e.jsx("div",{className:"panel-body",children:e.jsxs(D,{defaultActiveKey:"instances",id:"main-tabs",className:"mb-3 modern-tabs",children:[e.jsxs(w,{eventKey:"instances",title:"实例列表",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"实例列表"}),e.jsx(y,{onClick:()=>{m(),p(!0)},children:"创建新实例"})]}),e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(J,{onRefresh:()=>{f()}})})]}),e.jsx(w,{eventKey:"subscriptions",title:"订阅管理",children:e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(Q,{})})}),e.jsx(w,{eventKey:"traffic",title:"流量监控",children:e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(ee,{instances:c,selectedInstanceId:n,onInstanceChange:l})})}),e.jsx(w,{eventKey:"logs",title:"日志查看",children:e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(se,{instances:c,selectedInstanceId:n,onInstanceChange:l})})}),e.jsx(w,{eventKey:"yacd",title:"Yacd 控制台",children:e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(te,{instances:c,selectedInstanceId:n,onInstanceChange:l})})}),e.jsx(w,{eventKey:"metacubexd",title:"metacubexd 控制台",children:e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(ne,{instances:c,selectedInstanceId:n,onInstanceChange:l})})}),e.jsx(w,{eventKey:"zashboard",title:"Zashboard 控制台",children:e.jsx(t.Suspense,{fallback:e.jsx(_,{}),children:e.jsx(re,{instances:c,selectedInstanceId:n,onInstanceChange:l})})})]})}),e.jsxs(v,{show:h,onHide:()=>!r&&p(!1),children:[e.jsx(v.Header,{closeButton:!r,children:e.jsx(v.Title,{children:"创建新实例"})}),e.jsxs(b,{onSubmit:j,children:[e.jsxs(v.Body,{children:[e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"实例名称"}),e.jsx(b.Control,{type:"text",value:i.name,onChange:a=>x({...i,name:a.target.value}),required:!0,disabled:r})]}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"订阅"}),e.jsxs(b.Select,{value:i.subscription_id||"",onChange:a=>x({...i,subscription_id:a.target.value?parseInt(a.target.value):null}),required:!0,disabled:r,children:[e.jsx("option",{value:"",children:"选择订阅"}),u.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"管理端口（可选，自动分配）"}),e.jsx(b.Control,{type:"number",value:i.port||"",onChange:a=>x({...i,port:a.target.value?parseInt(a.target.value):null}),disabled:r})]}),e.jsxs(b.Group,{className:"mb-3",children:[e.jsx(b.Label,{children:"混合端口（可选，自动分配）"}),e.jsx(b.Control,{type:"number",value:i.mixed_port||"",onChange:a=>x({...i,mixed_port:a.target.value?parseInt(a.target.value):null}),disabled:r})]})]}),e.jsxs(v.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:()=>p(!1),disabled:r,children:"取消"}),e.jsx(y,{variant:"primary",type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"创建中..."]}):"创建"})]})]})]})]})}function ie({show:s,onHide:n,title:l}){const{showToast:c}=I(),[d,h]=t.useState(""),[p,r]=t.useState(!1),[g,i]=t.useState(!1),[x,u]=t.useState(null);t.useEffect(()=>{s&&C()},[s]);const C=async()=>{var m,j;r(!0),u(null);try{const a=await A.getExtendConfig();h(a.data.content||"")}catch(a){u(((j=(m=a.response)==null?void 0:m.data)==null?void 0:j.detail)||"加载配置文件失败"),h("")}finally{r(!1)}},f=async()=>{var m,j;i(!0),u(null);try{await A.saveExtendConfig(d),n(),c("配置文件保存成功","success")}catch(a){const S=((j=(m=a.response)==null?void 0:m.data)==null?void 0:j.detail)||"保存配置文件失败";u(S),c(S,"error")}finally{i(!1)}};return e.jsxs(v,{show:s,onHide:n,size:"lg",fullscreen:"lg-down",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:l})}),e.jsxs(v.Body,{style:{padding:0},children:[x&&e.jsx("div",{className:"alert alert-danger m-3 mb-0",role:"alert",children:x}),p?e.jsx("div",{className:"p-5 text-center",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"加载中..."})})}):e.jsx("textarea",{value:d,onChange:m=>h(m.target.value),style:{width:"100%",height:"70vh",padding:"15px",fontFamily:'Consolas, Monaco, "Courier New", monospace',fontSize:"13px",lineHeight:"1.5",border:"none",outline:"none",backgroundColor:"#1e1e1e",color:"#d4d4d4",resize:"none",whiteSpace:"pre",overflowWrap:"normal",overflowX:"auto"},spellCheck:!1})]}),e.jsxs(v.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:n,disabled:g,children:"取消"}),e.jsx(y,{variant:"primary",onClick:f,disabled:p||g,children:g?"保存中...":"保存"})]})]})}function oe(){const{showToast:s}=I(),[n,l]=t.useState(!1),[c,d]=t.useState(null),[h,p]=t.useState(!1),r=async()=>{var i,x;try{const u=await P.getStatus();d(u.data)}catch(u){((i=u.response)==null?void 0:i.status)===404||((x=u.response)==null?void 0:x.status)===400?d({installed:!1,running:!1,service_name:"ClashMultiInstanceManager"}):console.error("获取服务状态失败:",u)}};t.useEffect(()=>{n&&r()},[n]);const g=async()=>{var i,x;p(!0);try{await P.install(),s("服务注册成功","success"),await r()}catch(u){s(((x=(i=u.response)==null?void 0:i.data)==null?void 0:x.detail)||"服务注册失败","error")}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"outline-light",size:"sm",onClick:()=>l(!0),className:"ghost-button me-2",children:"Windows 服务控制"}),e.jsxs(v,{show:n,onHide:()=>l(!1),children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Windows 服务控制"})}),e.jsx(v.Body,{children:c?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"服务名称:"})," ",c.service_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"安装状态:"})," ",c.installed?"已安装":"未安装"]}),c.installed&&e.jsxs("p",{children:[e.jsx("strong",{children:"运行状态:"})," ",c.running?"运行中":"已停止"]}),e.jsx("div",{className:"mt-3",children:c.installed?null:e.jsx(y,{variant:"primary",onClick:g,disabled:h,className:"me-2",children:h?"注册中...":"注册服务"})}),e.jsx("div",{className:"mt-3 text-muted small",children:e.jsx("p",{children:"提示：注册/卸载服务需要管理员权限"})})]}):e.jsx("p",{children:"读取中..."})}),e.jsx(v.Footer,{children:e.jsx(y,{variant:"secondary",onClick:()=>l(!1),children:"关闭"})})]})]})}function le(){const{showToast:s}=I(),[n,l]=t.useState(!1),[c,d]=t.useState(""),[h,p]=t.useState(""),[r,g]=t.useState(!1);t.useEffect(()=>{$.getVersion().then(u=>{u.data.version&&u.data.version!=="unknown"&&u.data.version!=="not_found"&&u.data.version!=="error"&&(d(u.data.version),p(u.data.full_output||""))}).catch(u=>{console.error("获取 Clash 版本失败:",u)})},[]);const i=(u,C)=>{const f=u.replace(/^v/i,"").split(".").map(Number),m=C.replace(/^v/i,"").split(".").map(Number),j=Math.max(f.length,m.length);for(let a=0;a<j;a++){const S=f[a]||0,N=m[a]||0;if(S>N)return 1;if(S<N)return-1}return 0},x=async()=>{var u,C;if(!c){s("请先获取当前版本信息","warning");return}g(!0);try{const m=(await $.getLatestVersion()).data.latest_version.trim();if(!m)throw new Error("无法获取版本号");const j=i(m,c);j>0?s(`发现新版本: ${m}`,"info"):j<0?s(`当前版本 ${c} 新于最新发布版`,"success"):s("已经是最新版本","success")}catch(f){console.error("检查更新失败:",f);const m=((C=(u=f.response)==null?void 0:u.data)==null?void 0:C.detail)||f.message||"检查失败";s("检查更新失败: "+m,"error")}finally{g(!1)}};return e.jsx(O,{children:e.jsx("div",{className:"app-shell",children:e.jsxs("div",{className:"app-container container-xxl py-4",children:[e.jsxs("div",{className:"app-hero mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"brand-mark",children:"CM"}),e.jsxs("div",{children:[e.jsx("p",{className:"eyebrow",children:"Clash Multi-Instance"}),e.jsx("h1",{className:"hero-title",children:"Clash多实例管理后台"}),e.jsx("p",{className:"hero-subtitle",children:"现代化的轻量控制台，集中管理订阅、实例、流量与系统代理。"})]})]}),e.jsxs("div",{className:"d-flex flex-column align-items-start align-items-lg-end gap-2 ms-lg-auto",children:[c?e.jsxs("div",{className:"version-chip",title:h,children:[e.jsxs("div",{className:"version-chip__label",children:["Clash v",c]}),e.jsx(y,{variant:"outline-light",size:"sm",onClick:x,disabled:r,className:"ghost-button ghost-button--compact",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"检查中..."]}):"检查更新"})]}):e.jsx("div",{className:"version-chip",children:e.jsx("div",{className:"version-chip__label",children:"版本信息读取中..."})}),e.jsxs("div",{className:"hero-actions",children:[e.jsx(oe,{}),e.jsx(y,{variant:"light",size:"sm",onClick:()=>l(!0),className:"accent-button",children:"全局扩展配置"})]})]})]}),e.jsx("div",{className:"panel-card mt-4",children:e.jsx(z,{children:e.jsx(B,{path:"/",element:e.jsx(ae,{})})})}),e.jsx(ie,{show:n,onHide:()=>l(!1),title:"全局扩展配置"})]})})})}function ce(){return e.jsx(Y,{children:e.jsx(le,{})})}L.createRoot(document.getElementById("root")).render(e.jsx(K.StrictMode,{children:e.jsx(ce,{})}));export{R as i,pe as l,G as s,I as u};
